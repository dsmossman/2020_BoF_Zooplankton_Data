df$FTLE[df$FTLE <= cutoff] = NA
df = na.omit(df)
for(k in 1:nrow(df)) {
persistence_df$persistence[persistence_df$grid_id == df$Cell_ID[k]] = persistence_df$persistence[persistence_df$grid_id == df$Cell_ID[k]] + 1
}
} else {
break
}
}
for (i in 788:length(data_filenames)) {
df = read_csv(data_filenames[i], show_col_types = F)
if(nrow(df) == nrow(df_squares)) {
df = df %>% mutate(Cell_ID = df_squares$grid_id) %>%
na.omit() %>%
st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326)
# remove non-strong FTLEs and the fill values here so I don't have to keep saving the files over and over
df$FTLE[df$FTLE <= cutoff] = NA
ftle_day = format(df$Time[1], format = "%Y-%m-%d %HH")
print(paste0("Number of strong FTLE values for ", df$Time[1], " is ", nrow(df)))
if (nrow(df) == 0) {
# if the dataframe is empty
rm(df) # ditch the dataframe
next # proceed to the next file
} else {
if (ftle_day %in% gdata_dates) {
# grab the subset of the zoop data from that date
gdata_subset = gdata[format(gdata$time, format = "%Y-%m-%d %HH") == ftle_day, ]
for (m in 1:nrow(gdata_subset)) {
cell_IDs = eval(parse(text = unlist(gdata_subset$Cell_ID[m])))
if(length(cell_IDs) >= 1) {
gdata_subset$FTLE_value[m] = mean(df$FTLE[df$Cell_ID %in% cell_IDs], na.rm=T)
} else
next
}
# insert the subset back into the regular dataframe
gdata$FTLE_value[gdata$Hour == ftle_day] = gdata_subset$FTLE_value
}
}
} else {
break
}
}
for(j in 100:length(data_filenames)) {
df = read_csv(data_filenames[j], show_col_types = F)
if(nrow(df) == nrow(persistence_df)) {
df = df %>%
mutate(Cell_ID = df_squares$grid_id) %>%
na.omit() %>%
st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326)
df$FTLE[df$FTLE <= cutoff] = NA
df = na.omit(df)
for(k in 1:nrow(df)) {
persistence_df$persistence[persistence_df$grid_id == df$Cell_ID[k]] = persistence_df$persistence[persistence_df$grid_id == df$Cell_ID[k]] + 1
}
} else {
break
}
}
for(j in 591:length(data_filenames)) {
df = read_csv(data_filenames[j], show_col_types = F)
if(nrow(df) == nrow(persistence_df)) {
df = df %>%
mutate(Cell_ID = df_squares$grid_id) %>%
na.omit() %>%
st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326)
df$FTLE[df$FTLE <= cutoff] = NA
df = na.omit(df)
for(k in 1:nrow(df)) {
persistence_df$persistence[persistence_df$grid_id == df$Cell_ID[k]] = persistence_df$persistence[persistence_df$grid_id == df$Cell_ID[k]] + 1
}
} else {
break
}
}
for(j in 646:length(data_filenames)) {
df = read_csv(data_filenames[j], show_col_types = F)
if(nrow(df) == nrow(persistence_df)) {
df = df %>%
mutate(Cell_ID = df_squares$grid_id) %>%
na.omit() %>%
st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326)
df$FTLE[df$FTLE <= cutoff] = NA
df = na.omit(df)
for(k in 1:nrow(df)) {
persistence_df$persistence[persistence_df$grid_id == df$Cell_ID[k]] = persistence_df$persistence[persistence_df$grid_id == df$Cell_ID[k]] + 1
}
} else {
break
}
}
persistence_df$persistence = persistence_df$persistence/(j - 1)
persistence_df = persistence_df %>% filter(persistence > 0)
View(gdata)
save(list = c("gdata", "df_squares", "ftle_value_data"), file = "C:/Users/Delphine/Box/Glider Data/ru32-20240904T1537_gdata.rda")
save(list = c("persistence_df"), file = "C:/Users/Delphine/Box/Glider Data/ru32-20240904T1537_persistence.rda")
setwd("C:/Users/dmossman/Box/2022 MSc Thesis Work")
#####
setwd("C:/Users/Delphine/Documents/2020_BoF_Zooplankton_Data")
setwd("C:/Users/Delphine/Documents/2020_BoF_Zooplankton_Data")
## Libraries
library(tidyverse)
library(oce)
library(ocedata)
library(R.utils)
library(readxl)
library(ggpubr)
library(pracma)
## Project Structure
sourceDirectory('Code/Hansen Zooplankton Code and Sample Data/src',
modifiedOnly = F)
function_dir = 'Code/Hansen Zooplankton Code and Sample Data/src/'
create_dir(function_dir)
cache_dir = 'Processed_Data/'
create_dir(cache_dir)
data_dir = 'Raw_Data/'
create_dir(data_dir)
figure_dir = 'Visuals/'
create_dir(figure_dir)
report_dir = getwd()
create_dir(report_dir)
## Load in data structures created by Multinet_Abundance_Processing.R
load(paste0(cache_dir, 'Multi_Data.rda'))
load(paste0(cache_dir, 'Net_Metadata.rda'))
load(paste0(cache_dir, 'Net_Data.rda'))
load(paste0(cache_dir, 'Abundance_Data_Concentration.rda'))
load(paste0(cache_dir, 'Abundance_Data_Biomass.rda'))
load(paste0(cache_dir, "Cfin_Stages.rda"))
outdir = paste0(figure_dir,'Station_Concentrations/')
create_dir(outdir)
nts = list()
i=1
# define station
stn = levels(Net_Data$station)[i]
# define output file
fout = paste0(outdir, stn, '_net_separated_weighted_concentrations.png')
message('Plotting weighted concentrations for sample ', stn, ' and saving it as: ', fout)
# subset for plotting
tmp = subset(Net_Data, Net_Data$station == stn)
tmp = droplevels(tmp)
ylim_cts = range(tmp$weighted_concentration, na.rm = TRUE)
nts[[paste0(stn)]] = subset(Net_Data, Net_Data$station == stn)
ggplot(data = tmp, aes(x = reorder(taxa, weighted_concentration, function(x) sum(x)), y = weighted_concentration)) +
geom_bar(stat = "identity", aes(fill = net), color = "black", na.rm = T) +
scale_fill_manual(values=rev(oceColorsViridis(6)))+
theme_bw()+
theme(axis.text.x=element_text(angle=45,hjust=1,vjust=1)) +
labs(title = paste0('Date: ', tmp$sample_date[1],
', Site: ', tmp$site[1],
', Station: ', stn),
x = "Sampled Taxa",
y = expression(paste("Weighted Concentration (individuals/m"^"2"*")")),
fill = "Net #") +
theme(plot.title = element_text(hjust = 0.5))
outdir = paste0(figure_dir,'Abundances/')
create_dir(outdir)
load(paste0(cache_dir, 'Abundance_Data_Concentration.rda'))
load(paste0(cache_dir, 'Abundance_Data_Biomass.rda'))
test = Abundance_Data_Concentration %>% group_by(station, site) %>% summarise(total_concentration = sum(concentration, na.rm = T))
View(test)
test = Abundance_Data_Concentration %>% group_by(station, site) %>% summarise(total_concentration = sum(weighted_concentration, na.rm = T))
Abundance_Data_Concentration = Net_Data %>% group_by(station, sample_date, site, taxa) %>% summarise(concentration = sum(concentration, na.rm = TRUE),
weighted_concentration = sum(weighted_concentration, na.rm = T))
total_concentrations = Abundance_Data_Concentration %>% summarise(concentration = sum(concentration, na.rm = TRUE),
weighted_concentration = sum(weighted_concentration, na.rm = T))
Abundance_Data_Concentration$relative_abundance = NA
Abundance_Data_Concentration = Abundance_Data_Concentration[which(Abundance_Data_Concentration$site == "OB" | Abundance_Data_Concentration$site == "GMB"),]
View(Abundance_Data_Concentration)
Abundance_Data_Concentration$relative_weighted_abundance = NA
for(i in 1:nrow(Abundance_Data_Concentration)) {
Abundance_Data_Concentration$relative_abundance[i] = Abundance_Data_Concentration$concentration[i] /
total_concentrations$concentration[which(total_concentrations$station == Abundance_Data_Concentration$station[i])]
Abundance_Data_Concentration$relative_weighted_abundance[i] = Abundance_Data_Concentration$weighted_concentration[i] /
total_concentrations$weighted_concentration[which(total_concentrations$station == Abundance_Data_Concentration$station[i])]
}
View(Abundance_Data_Concentration)
save(Abundance_Data_Concentration, file = paste0(cache_dir, "Abundance_Data_Concentration.rda"))
test = Abundance_Data_Concentration %>% group_by(station, site) %>% summarise(total_concentration = sum(weighted_concentration, na.rm = T))
View(test)
Abundance_Data_Concentration = Abundance_Data_Concentration %>% group_by(station, site, taxa) %>% summarise(concentration = sum(weighted_concentration, na.rm = T))
Abundance_Data_Concentration$relative_abundance = NA
for(i in 1:nrow(Abundance_Data_Concentration)) {
Abundance_Data_Concentration$relative_abundance[i] = Abundance_Data_Concentration$concentration[i] / test$total_concentration[test$station == Abundance_Data_Concentration$station[i]]
}
Abundance_Data_Concentration = Abundance_Data_Concentration %>% group_by(site, taxa) %>% summarise(mean_abundance = mean(concentration), mean_relative_abundance = mean(relative_abundance), ste_abundance = std_err(concentration), std_abundance = sd(concentration))
View(Abundance_Data_Concentration)
D_Int_Net_Data = Net_Data %>% group_by(station, site, taxa) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup() %>% group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T), st_dev_concentration = sd(d_int_concentration, na.rm = T)) %>%
complete(site, taxa, fill = list(avg_d_int_concentration = 0, st_dev_concentration = 0))
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
library(ggbreak)
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
View(D_Int_Net_Data)
D_Int_Net_Data = Net_Data %>% group_by(station, site, taxa) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup() %>% group_by(site, taxa)
D_Int_Net_Data = Net_Data %>% group_by(station, site, taxa) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup() %>% group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T), st_dev_concentration = sd(d_int_concentration, na.rm = T))
D_Int_Net_Data = Net_Data %>% group_by(station, site, taxa) %>%
reframe(d_int_concentration = mean(weighted_concentration, na.rm=T))
View(D_Int_Net_Data)
D_Int_Net_Data = Net_Data %>% group_by(station, site, taxa) %>%
reframe(d_int_concentration = mean(weighted_concentration, na.rm=T)) %>%
ungroup() %>% group_by(site, taxa) %>%
reframe(avg_d_int_concentration = sum(d_int_concentration, na.rm = T), st_dev_concentration = sd(d_int_concentration, na.rm = T)) %>%
complete(site, taxa, fill = list(avg_d_int_concentration = 0, st_dev_concentration = 0))
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
D_Int_Net_Data = Net_Data %>% group_by(station, site, taxa) %>%
reframe(d_int_concentration = mean(weighted_concentration, na.rm=T), sd_d_int_concentration = sd(weighted_concentration)) %>%
ungroup() %>% group_by(site, taxa) %>%
reframe(avg_d_int_concentration = sum(d_int_concentration, na.rm = T), st_dev_concentration = mean(sd_d_int_concentration, na.rm = T)) %>%
complete(site, taxa, fill = list(avg_d_int_concentration = 0, st_dev_concentration = 0))
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
D_Int_Net_Data = Net_Data %>% group_by(station, site, taxa) %>%
reframe(d_int_concentration = mean(weighted_concentration, na.rm=T)) %>%
ungroup() %>% group_by(site, taxa) %>%
reframe(avg_d_int_concentration = sum(d_int_concentration, na.rm = T), st_dev_concentration = sd(d_int_concentration, na.rm = T)) %>%
complete(site, taxa, fill = list(avg_d_int_concentration = 0, st_dev_concentration = 0))
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
View(total_concentrations)
total_concentrations = Net_Data %>% group_by(site) %>% reframe(total_concentration = sum(concentration, na.rm = T))
View(total_concentrations)
total_concentrations = Net_Data %>% group_by(site) %>% reframe(total_concentration = sum(weighted_concentration, na.rm = T))
D_Int_Net_Data = Net_Data %>% group_by(station, site, taxa) %>%
complete(site, taxa, fill = list(weighted_concentration = 0)) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup() %>% group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T), st_dev_concentration = sd(d_int_concentration, na.rm = T))
D_Int_Net_Data = Net_Data %>% complete(site, taxa, fill = list(weighted_concentration = 0)) %>%
group_by(station, site, taxa) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup() %>% group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T), st_dev_concentration = sd(d_int_concentration, na.rm = T))
View(D_Int_Net_Data)
total_concentrations = Net_Data %>% group_by(site) %>% reframe(total_concentration = sum(weighted_concentration, na.rm = T))
D_Int_Net_Data$relative_weighted_abundance = NA
D_Int_Net_Data = Net_Data %>% complete(site, taxa, fill = list(weighted_concentration = 0)) %>%
group_by(station, site, taxa) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup()
D_Int_Net_Data$relative_weighted_abundance = NA
total_concentrations = Net_Data %>% group_by(station) %>% reframe(total_concentration = sum(weighted_concentration, na.rm = T))
total_concentrations = Net_Data %>% group_by(station) %>% reframe(total_concentration = sum(weighted_concentration, na.rm = T))
D_Int_Net_Data$relative_weighted_abundance = NA
for(i in 1:nrow(D_Int_Net_Data)) {
D_Int_Net_Data$relative_weighted_abundance[i] = D_Int_Net_Data$d_int_concentration[D_Int_Net_Data$station[i] == total_concentrations$station]
}
warnings()
for(i in 1:nrow(D_Int_Net_Data)) {
D_Int_Net_Data$relative_weighted_abundance[i] = D_Int_Net_Data$d_int_concentration[i] / total_concentrations$total_concentration[D_Int_Net_Data$station[i] == total_concentrations$station]
}
warnings()
D_Int_Net_Data$relative_weighted_abundance[i] = D_Int_Net_Data$d_int_concentration[i] / total_concentrations$total_concentration[total_concentrations$station == D_Int_Net_Data$station[i]]
total_concentrations$total_concentration[total_concentrations$station == D_Int_Net_Data$station[i]]
total_concentrations$station == D_Int_Net_Data$station[i]]
i
D_Int_Net_Data$station[i]
? complete
D_Int_Net_Data = Net_Data %>% complete(taxa, nesting(site, station), fill = list(weighted_concentration = 0)) %>%
group_by(station, site, taxa) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup()
View(D_Int_Net_Data)
total_concentrations = Net_Data %>% group_by(station) %>% reframe(total_concentration = sum(weighted_concentration, na.rm = T))
D_Int_Net_Data$relative_weighted_abundance = NA
for(i in 1:nrow(D_Int_Net_Data)) {
D_Int_Net_Data$relative_weighted_abundance[i] = D_Int_Net_Data$d_int_concentration[i] / total_concentrations$total_concentration[total_concentrations$station == D_Int_Net_Data$station[i]]
}
D_Int_Net_Data = D_Int_Net_Data %>%
filter(relative_weighted_abundance > 0.005) %>%
group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T), st_dev_concentration = sd(d_int_concentration, na.rm = T))
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
D_Int_Net_Data = Net_Data %>%
group_by(station, site, taxa) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup()
total_concentrations = Net_Data %>% group_by(station) %>% reframe(total_concentration = sum(weighted_concentration, na.rm = T))
D_Int_Net_Data$relative_weighted_abundance = NA
for(i in 1:nrow(D_Int_Net_Data)) {
D_Int_Net_Data$relative_weighted_abundance[i] = D_Int_Net_Data$d_int_concentration[i] / total_concentrations$total_concentration[total_concentrations$station == D_Int_Net_Data$station[i]]
}
D_Int_Net_Data = D_Int_Net_Data %>%
filter(relative_weighted_abundance > 0.005) %>%
group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T), st_dev_concentration = sd(d_int_concentration, na.rm = T))
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
load(paste0(cache_dir, 'Abundance_Data_Concentration.rda'))
test = Abundance_Data_Concentration %>% group_by(station, site) %>% summarise(total_concentration = sum(concentration, na.rm = T))
Abundance_Data_Concentration = Abundance_Data_Concentration %>% group_by(station, site, taxa) %>% summarise(concentration = sum(concentration, na.rm = T))
Abundance_Data_Concentration$relative_abundance = NA
for(i in 1:nrow(Abundance_Data_Concentration)) {
Abundance_Data_Concentration$relative_abundance[i] = Abundance_Data_Concentration$concentration[i] / test$total_concentration[test$station == Abundance_Data_Concentration$station[i]]
}
Abundance_Data_Concentration = Abundance_Data_Concentration %>% group_by(site, taxa) %>% summarise(mean_abundance = mean(relative_abundance), ste_abundance = std_err(relative_abundance), std_abundance = sd(relative_abundance))
Abundance_Data_Concentration = Abundance_Data_Concentration[Abundance_Data_Concentration$mean_abundance >= 0.005,]
Abundance_Data_Concentration = Abundance_Data_Concentration %>% arrange(taxa, site)
Abundance_Data_Concentration = rbind(Abundance_Data_Concentration, Abundance_Data_Concentration[c(1:5,14:18,25,26,31:33),])
Abundance_Data_Concentration[34:48,3:5] = 0
Abundance_Data_Concentration[c(34:41,45,48),1] = "GMB"
Abundance_Data_Concentration[c(42:44,46,47),1] = "OB"
Abundance_Data_Concentration = Abundance_Data_Concentration %>% arrange(taxa, site)
ggplot(data = Abundance_Data_Concentration, aes(
x = reorder(taxa, mean_abundance, function(x)
- sum(x)),
y = mean_abundance,
fill = site,
group = site
)) +
geom_col(
na.rm = F,
color = "black",
position = position_dodge(preserve = "single")
) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
scale_x_discrete(drop = FALSE) +
geom_errorbar(
stat = "identity",
na.rm = F,
aes(
ymin = mean_abundance - ste_abundance,
ymax = mean_abundance + ste_abundance,
group = factor(site)
),
position = position_dodge(0.9, preserve = "single"),
size = 0.3,
width = 0.5
) +
scale_y_continuous(labels = scales::percent) +
theme_bw() +
theme(axis.text.x = element_text(
angle = 60,
hjust = 1,
vjust = 1
)) +
labs(x = "Sampled Taxa",
y = "Relative Abundance (% of total concentration)",
fill = "Basin") +
theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 16))
load(paste0(cache_dir, 'Abundance_Data_Concentration.rda'))
test = Abundance_Data_Concentration %>% group_by(station, site) %>% summarise(total_concentration = sum(weighted_concentration, na.rm = T))
Abundance_Data_Concentration = Abundance_Data_Concentration %>% group_by(station, site, taxa) %>% summarise(concentration = sum(weighted_concentration, na.rm = T))
D_Int_Net_Data = Net_Data %>%
group_by(station, site, taxa) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup()
total_concentrations = Net_Data %>% group_by(station, site) %>% summarise(total_concentration = sum(concentration, na.rm = T))
D_Int_Net_Data$relative_weighted_abundance = NA
for(i in 1:nrow(D_Int_Net_Data)) {
D_Int_Net_Data$relative_weighted_abundance[i] = D_Int_Net_Data$d_int_concentration[i] / total_concentrations$total_concentration[total_concentrations$station == D_Int_Net_Data$station[i]]
}
View(D_Int_Net_Data)
D_Int_Net_Data = D_Int_Net_Data %>%
group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T), st_dev_concentration = sd(d_int_concentration, na.rm = T))
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
D_Int_Net_Data = D_Int_Net_Data %>%
group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T),
st_dev_concentration = sd(d_int_concentration, na.rm = T),
relative_weighted_abundance = mean(relative_weighted_abundance, na.rm = T))
D_Int_Net_Data = Net_Data %>%
group_by(station, site, taxa) %>%
reframe(d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup()
total_concentrations = Net_Data %>% group_by(station, site) %>% summarise(total_concentration = sum(concentration, na.rm = T))
D_Int_Net_Data$relative_weighted_abundance = NA
for(i in 1:nrow(D_Int_Net_Data)) {
D_Int_Net_Data$relative_weighted_abundance[i] = D_Int_Net_Data$d_int_concentration[i] / total_concentrations$total_concentration[total_concentrations$station == D_Int_Net_Data$station[i]]
}
D_Int_Net_Data = D_Int_Net_Data %>%
group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T),
st_dev_concentration = sd(d_int_concentration, na.rm = T),
relative_weighted_abundance = mean(relative_weighted_abundance, na.rm = T))
View(D_Int_Net_Data)
D_Int_Net_Data = Net_Data %>%
group_by(station, site, taxa) %>%
reframe(concentration = sum(concentration, na.rm = T),
d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup()
total_concentrations = Net_Data %>% group_by(station, site) %>% summarise(total_concentration = sum(concentration, na.rm = T))
D_Int_Net_Data$relative_weighted_abundance = NA
for(i in 1:nrow(D_Int_Net_Data)) {
D_Int_Net_Data$relative_weighted_abundance[i] = D_Int_Net_Data$concentration[i] / total_concentrations$total_concentration[total_concentrations$station == D_Int_Net_Data$station[i]]
}
D_Int_Net_Data = D_Int_Net_Data %>%
group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T),
st_dev_concentration = sd(d_int_concentration, na.rm = T),
relative_weighted_abundance = mean(relative_weighted_abundance, na.rm = T))
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
D_Int_Net_Data = Net_Data %>%
group_by(station, site, taxa) %>%
reframe(concentration = sum(concentration, na.rm = T),
d_int_concentration = sum(weighted_concentration, na.rm=T)) %>%
ungroup()
total_concentrations = Net_Data %>% group_by(station, site) %>% summarise(total_concentration = sum(concentration, na.rm = T))
D_Int_Net_Data$relative_abundance = NA
for(i in 1:nrow(D_Int_Net_Data)) {
D_Int_Net_Data$relative_abundance[i] = D_Int_Net_Data$concentration[i] / total_concentrations$total_concentration[total_concentrations$station == D_Int_Net_Data$station[i]]
}
D_Int_Net_Data = D_Int_Net_Data %>%
group_by(site, taxa) %>%
reframe(avg_d_int_concentration = mean(d_int_concentration, na.rm = T),
st_dev_concentration = sd(d_int_concentration, na.rm = T),
relative_abundance = mean(relative_abundance, na.rm = T)) %>%
filter(relative_abundance >= 0.005)
ggplot(data = D_Int_Net_Data, aes(x = reorder(taxa, avg_d_int_concentration, function(x)
- sum(x)),  group = site)) +
geom_col(aes(y = avg_d_int_concentration, fill = site), color = "black", position = position_dodge2()) +
geom_errorbar(aes(ymin = avg_d_int_concentration - st_dev_concentration,
ymax = avg_d_int_concentration + st_dev_concentration),
position = position_dodge2()) +
# scale_y_continuous(limits = c(0, 100000)) +
scale_y_break(breaks = c(10000,10000), expand = F, scales = 0.15) +
scale_fill_manual(values = rev(oceColorsViridis(6)), drop = FALSE) +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
coord_cartesian(ylim = c(0,100000), expand = F)
